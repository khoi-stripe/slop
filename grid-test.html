<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grid Test</title>
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; overflow: hidden; }
    body {
      font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: #c1121f;
      color: #e8ecf6;
    }

    .app {
      width: 100vw;
      height: 100vh;
      padding: clamp(8px, 1.5cqi, 24px);
      display: grid;
      place-items: center;
      /* Enable container queries */
      container-type: size;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      grid-template-rows: repeat(5, 1fr);
      gap: clamp(6px, 1cqi, 16px);
      padding: clamp(4px, 0.6cqi, 12px);
      background: rgba(0,0,0,0.1);
      /* Fit within container, maintaining 16:9 */
      max-height: 100%;
      max-width: 100%;
      width: min(100%, calc(100cqh * (16 / 9)));
      height: min(100%, calc(100cqw * (9 / 16)));
      aspect-ratio: 16 / 9;
    }

    .tile {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 4px;
      display: grid;
      place-items: center;
      text-align: center;
      padding: clamp(8px, 1.5cqi, 24px);
      font-size: clamp(14px, 1.25cqi, 40px);
      font-weight: 700;
      line-height: 1.2;
    }

    .center {
      grid-column: 2 / span 4;
      grid-row: 2 / span 3;
      background: radial-gradient(circle, #1c2347, #12162a);
      border: 1px solid rgba(255,255,255,0.3);
      padding: 0;
      overflow: hidden;
      display: grid;
      place-items: center;
    }
    
    .center img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="board" id="board">
      <!-- Perimeter tiles -->
      <div class="tile" style="grid-column: 1; grid-row: 1;">1</div>
      <div class="tile" style="grid-column: 2; grid-row: 1;">2</div>
      <div class="tile" style="grid-column: 3; grid-row: 1;">3</div>
      <div class="tile" style="grid-column: 4; grid-row: 1;">4</div>
      <div class="tile" style="grid-column: 5; grid-row: 1;">5</div>
      <div class="tile" style="grid-column: 6; grid-row: 1;">6</div>
      
      <div class="tile" style="grid-column: 6; grid-row: 2;">7</div>
      <div class="tile" style="grid-column: 6; grid-row: 3;">8</div>
      <div class="tile" style="grid-column: 6; grid-row: 4;">9</div>
      
      <div class="tile" style="grid-column: 6; grid-row: 5;">10</div>
      <div class="tile" style="grid-column: 5; grid-row: 5;">11</div>
      <div class="tile" style="grid-column: 4; grid-row: 5;">12</div>
      <div class="tile" style="grid-column: 3; grid-row: 5;">13</div>
      <div class="tile" style="grid-column: 2; grid-row: 5;">14</div>
      <div class="tile" style="grid-column: 1; grid-row: 5;">15</div>
      
      <div class="tile" style="grid-column: 1; grid-row: 4;">16</div>
      <div class="tile" style="grid-column: 1; grid-row: 3;">17</div>
      <div class="tile" style="grid-column: 1; grid-row: 2;">18</div>
      
      <!-- Center tile -->
      <div class="center" id="center">
        <img id="centerImage" alt="Center" />
      </div>
    </div>
  </div>

  <script>
    // Configuration system
    let DEFAULT_CONFIG = {
      centerImageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Emoji_u1f389.svg/512px-Emoji_u1f389.svg.png",
      gremlin: { title: "AI Gremlin", imageUrl: "" },
      options: [
        { id: "A", title: "Option A" },
        { id: "B", title: "Option B" },
        { id: "C", title: "Option C" },
        { id: "D", title: "Option D" },
        { id: "E", title: "Option E" },
        { id: "F", title: "Option F" }
      ]
    };

    const STORAGE_KEY = "pyl_config_v1";

    async function tryLoadDefaultFromConfigJson() {
      try {
        const res = await fetch('./config.json', { cache: 'no-store' });
        if (!res.ok) return;
        const json = await res.json();
        if (!json || !Array.isArray(json.options) || json.options.length !== 6) return;
        DEFAULT_CONFIG = json;
      } catch {}
    }

    function loadConfig() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return structuredClone(DEFAULT_CONFIG);
        const cfg = JSON.parse(raw);
        if (!cfg.options || cfg.options.length !== 6) return structuredClone(DEFAULT_CONFIG);
        return cfg;
      } catch (e) {
        return structuredClone(DEFAULT_CONFIG);
      }
    }

    let config;
    const centerImg = document.getElementById("centerImage");

    // Get all perimeter tiles (numbered 1-18)
    const tiles = [];
    for (let i = 1; i <= 18; i++) {
      const tile = document.querySelector(`.tile:nth-child(${i})`);
      if (tile) tiles.push(tile);
    }

    function assignTitles() {
      // Assign 6 options to 18 tiles (3 tiles per option)
      const optionIds = config.options.map(o => o.id);
      const indices = Array.from({length: 18}, (_, i) => i);
      // Shuffle
      for (let i = indices.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [indices[i], indices[j]] = [indices[j], indices[i]];
      }
      
      const byId = Object.fromEntries(config.options.map(o => [o.id, o]));
      
      for (let k = 0; k < optionIds.length; k++) {
        for (let rep = 0; rep < 3; rep++) {
          const tileIdx = indices[k * 3 + rep];
          const tile = tiles[tileIdx];
          const opt = byId[optionIds[k]];
          tile.textContent = opt.title;
          tile.dataset.optionId = optionIds[k];
        }
      }
    }

    // Initialize
    (async () => {
      await tryLoadDefaultFromConfigJson();
      config = loadConfig();
      centerImg.src = config.centerImageUrl || "";
      assignTitles();
    })();
  </script>
</body>
</html>

